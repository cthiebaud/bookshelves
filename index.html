<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bookshelves</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body>
    <div id="container" class="container-fluid">
        <h1 id="howmuch" style="text-align: center;">â€¦</h1>
        <h3 id="howmuch2" style="text-align: center;">â€¦</h3>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@latest/dist/js-yaml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script>
        const container = document.getElementById("container");

        function blend(property) {
            const fig = document.createElement("figure");
            fig.classList.add("figure")
            fig.style = "margin: .4rem; max-width: 9.4rem;"

            const img = document.createElement("img");
            img.src = property['image_path']
            img.classList.add("figure-img")
            img.classList.add("img-fluid")

            const figcaption = document.createElement("figcaption");
            figcaption.classList.add("figure-caption")
            figcaption.classList.add("text-wrap")
            figcaption.style = "width: 100%;"

            let lan = property['lan'] || '';
            if (lan) lan = lan - " "
            let author = property['de'].split(/ \(/)[0];
            let title = property['title']
            let where = property['where']
            const authorE = document.createTextNode(author);
            const titleE = document.createTextNode(title);
            const titleSPAN = document.createElement("span");
            titleSPAN.appendChild(titleE)
            titleSPAN.style = "font-size:smaller;"

            if (where.includes("lipion")) {
                const float1 = document.createElement("span");
                float1.classList.add("float-end")
                float1.style = "color: green"
                const flag = document.createTextNode('â¬¤');
                float1.appendChild(flag)
                figcaption.appendChild(float1)
            }
            const flagE = document.createTextNode(lan);
            const float2 = document.createElement("span");
            float2.classList.add("float-end")
            float2.appendChild(flagE)
            float2.style = "font-size: larger;"
            titleSPAN.appendChild(float2)
            figcaption.appendChild(authorE)
            figcaption.appendChild(document.createElement("br"))
            figcaption.appendChild(titleSPAN)
            fig.appendChild(img)
            fig.appendChild(figcaption)
            container.appendChild(fig)
        }

        function updateDisplay(text) {
            const doc = jsyaml.load(text, 'utf8')

            const entries = Object.entries(doc);

            entries.sort((a, b) => {
                const nameA = a[1].de.toUpperCase().split(/ \(/)[0]
                const nameB = b[1].de.toUpperCase().split(/ \(/)[0]
                const splitA = nameA.split(/ /)
                const splitB = nameB.split(/ /)
                const lastnameA = splitA[splitA.length - 1]
                const lastnameB = splitB[splitB.length - 1]
                const lastnameDifference = lastnameA.localeCompare(lastnameB)
                if (lastnameDifference !== 0) {
                    return lastnameDifference
                }
                const nameDifference = nameA.localeCompare(nameB)
                if (nameDifference !== 0) {
                    return nameDifference
                }
                if (typeof a[1].title === "undefined" || typeof b[1].title === "undefined") {
                    console.log("boum!")
                }
                const titleA = a[1].title.toUpperCase()
                const titleB = b[1].title.toUpperCase()
                return titleA.localeCompare(titleB)
            })

            let count = 0
            let _en = 0
            let _it = 0
            let _fr = 0
            let _de = 0
            let _pt = 0
            let _sp = 0
            for (const property in entries) {
                let skip = false
                if (typeof entries[property][1].tags !== "undefined") {
                    if (entries[property][1].tags.includes("Perec")) {
                    }
                    if (entries[property][1].tags.includes("verboten")) {
                        skip = true
                        console.log("SKIP", entries[property][1], entries[property][1].tags)
                    }
                }
                if (!skip) {
                    const entry = entries[property][1]
                    blend(entry)
                    switch (entry.lan) {
                        case 'ðŸ‡¬ðŸ‡§':
                            _en++
                            break;
                        case 'ðŸ‡®ðŸ‡¹':
                            _it++
                            break;
                        case 'ðŸ‡«ðŸ‡·':
                            _fr++
                            break;
                        case 'ðŸ‡©ðŸ‡ª':
                            _de++
                            break;
                        case 'ðŸ‡µðŸ‡¹':
                            _pt++
                            break;
                        case 'ðŸ‡ªðŸ‡¸':
                            _sp++
                            break;
                        default:
                            console.error("missing lan property", entry);
                    }
                    count++
                } else {
                    // console.log(entries[property][1])
                }

            }
            document.getElementById("howmuch").innerHTML = `${count}`
            document.getElementById("howmuch2").innerHTML = `ðŸ‡«ðŸ‡· ${_fr} ðŸ‡®ðŸ‡¹ ${_it} ðŸ‡¬ðŸ‡§ ${_en} ðŸ‡©ðŸ‡ª ${_de} ðŸ‡µðŸ‡¹ ${_pt} ðŸ‡ªðŸ‡¸ ${_sp} `

        }

        function fetchData() {
            const xhr = new XMLHttpRequest()
            xhr.open("GET", "everything.yaml", true)
            xhr.onload = () => {
                updateDisplay(xhr.response)
            };
            xhr.send()
        }

        fetchData()

    </script>
</body>

</html>