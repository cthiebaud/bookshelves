<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/fav/favicon-16x16.png">
    <link rel="manifest" href="/fav/site.webmanifest">
    <link rel="mask-icon" href="/fav/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/fav/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/fav/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <style>
        body {
            margin: 0;
        }

        .image-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            /* Center the rows horizontally */
            max-width: 100vw;
            /* Set the container width to the viewport width */
        }

        .image-container figure,
        .image-container .btn {
            max-width: 100%;
            /* Ensure images don't exceed the container width */
            height: auto;
            /* Maintain aspect ratio */
            margin: 0;
            /* Adjust margin as needed for spacing between images */
            box-sizing: border-box;
        }

        .left {
            text-align: right;
        }

        .right {
            text-align: left;
        }

        .category {
            min-height: 40px;
        }

        .category:after {
            content: "";
            /* This is necessary for the pseudo element to work. */
            display: block;
            /* This will put the pseudo element on its own line. */
            margin: 0 auto;
            /* This will center the border. */
            width: 67%;
            /* Change this to whatever width you want. */
            border-bottom: .5px solid lightgray;
            /* This creates the border. */
        }

        .figure-img {
            margin-bottom: 0.25rem;
        }

        #howmuch #total,
        #howmuch #current {
            font-size: 24px;
        }

        #howmuch #current.total {
            text-shadow: 2px 2px lightgray;
        }

        /* https://css-tricks.com/how-to-create-neon-text-with-css/ */
        .neonText {
            color: #fff;
            text-shadow:
                0 0 7px #fff,
                0 0 10px #fff,
                0 0 21px #fff,
                0 0 42px #0fa,
                0 0 82px #0fa,
                0 0 92px #0fa,
                0 0 102px #0fa,
                0 0 151px #0fa;
            animation: flicker 1.6s infinite alternate;
        }

        /* Flickering animation */
        @keyframes flicker {
            0%,
            18%,
            22%,
            25%,
            53%,
            57%,
            100% {
                text-shadow:
                    0 0 4px #fff,
                    0 0 11px #fff,
                    0 0 19px #fff,
                    0 0 40px #0fa,
                    0 0 80px #0fa,
                    0 0 90px #0fa,
                    0 0 100px #0fa,
                    0 0 150px #0fa;
            }
            20%,
            24%,
            55% {
                text-shadow: none;
            }
        }

        #howmuch #percent {
            font-size: 14px;
            font-weight: lighter;
        }

        #howmuch #circle_with_cross {
            font-size: 20px;
            color: #ccc;
            visibility: hidden;
            border: none;
            padding: 0;
        }

        .city-name {
            font-size: smaller;
        }

        #location .btn {
            font-size: 16px;
        }

        .svg-background {
            --background-image: url('svg/flags/transparent.svg');
            background-image: var(--background-image);
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .btn {
            /* Adjust as needed */
            background-origin: content-box;
        }

        .semi-transparent-badge {
            background-color: rgba(0, 123, 255, 0.5);
            /* Adjust the RGBA values and alpha (0.5 for semi-transparent) */
        }

        #langage .btn {
            padding: 2px;
            width: 42px;
            margin: 0.3rem;
        }

        #langage .btn span {
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.85) !important;
            font-weight: normal;
            min-height: 12px;
            margin: 0;
            padding: 0.1rem 0.3rem;
        }

        #tags .btn {
            vertical-align: text-bottom;
            font-size: 12px;
            line-height: 14px;
            margin: 0;
            padding: 4px;
        }

        #tags .btn span {
            font-size: 10px;
        }

        #letters .btn,
        #color .btn {
            font-size: 12px;
            margin: 0;
            padding: 6px;
        }

        #date .btn {
            font-size: 10px;
            line-height: 12px;
            margin: 0;
            padding: 4px;
        }

        .active>.btn:not(.active) {
            opacity: .5;
        }

        .color_black {
            color: black;
        }

        .color_white {
            color: white;
            text-shadow: -1px -1px 0 lightgray, 1px -1px 0 lightgray, -1px 1px 0 lightgray, 1px 1px 0 lightgray;
        }

        .color_gray {
            color: gray;
        }

        .color_red {
            color: red;
        }

        .color_yellow {
            color: yellow;
        }

        .color_green {
            color: green;
        }

        .color_cyan {
            color: cyan;
        }

        .color_blue {
            color: blue;
        }

        .color_magenta {
            color: magenta;
        }

        .btn:not(.active):hover {
            border: 1px outset #a0a0a0;
        }

        .sgl {
            display: inline-block;
            position: relative;
            width: 14px;
            height: 16px;
            z-index: 1;
        }

        .sgl::after {
            content: "";
            background-image: url(/svg/bronze.857-b-last-try.svg);
            background-repeat: no-repeat;
            background-size: cover;
            overflow: hidden;
            opacity: 0.5;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            position: absolute;
            z-index: -1;
        }

        .paletteBar {
            display: flex;
            min-height: 0.333rem;
            margin: 0 0 0.333rem 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <!-- loading -->
    <style>
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: auto;
            z-index: 20;
        }
    </style>
    <div id="loading">
        <div class="spinner-border" style="width: 4rem; height: 4rem;" role="status">
            <span class="visually-hidden">Loading…</span>
        </div>
    </div>
    <div id="container" class="container-md">
        <div id="howmuch" class="row align-items-center category">
            <div class="col-6 text-end">
                <span id="current" class="badge neonText font-monospace" style="background-color: #010a01;">&hellip;</span>
            </div>
            <div class="col-5">
                <span id="percent" class="font-monospace">&nbsp;</span>
            </div>
            <div class="col-1 text-end">
                <span id="circle_with_cross" class="btn">ⓧ</span>
            </div>
        </div>
        <div id="location" class="row align-items-center category">
            <div class="col-6 text-end">
                &nbsp;
                <a href="#" id="saint-lazare-de-savene" class="btn" role="button" data-bs-toggle="button" data-tags="saint-lazare-de-savene"
                    style="margin-right: calc(var(--bs-btn-padding-x) * -1);">
                    <span class="city-name">San&nbsp;Lazzaro</span>
                    <span id="c-saint-lazare-de-savene" class="font-monospace">&nbsp;</span>
                    <!-- ⥣ -->
                </a>
            </div>
            <div class="col-6 text-start">
                <a href="#" id="saint-jean-lipion" class="btn" role="button" data-bs-toggle="button" data-tags="saint-jean-lipion"
                    style="margin-left: calc(var(--bs-btn-padding-x) * -1);">
                    <!-- ⥥ -->
                    <span id="c-saint-jean-lipion" class="font-monospace">&nbsp;</span>
                    <span class="city-name">San&nbsp;Giovanni</span>
                    <span class="sgl"></span>
                </a>
                &nbsp;
            </div>
        </div>
        <!-- prettier-ignore -->
        <div id="langage" class="category">
            <div class="image-container">
                <a href="#" id="🇫🇷" class="btn svg-background" role="button" data-bs-toggle="button" data-tags="🇫🇷"><span id="c-🇫🇷"
                        class="badge text-bg-light rounded-pill font-monospace">&nbsp;</span></a>
                <a href="#" id="🇮🇹" class="btn svg-background" role="button" data-bs-toggle="button" data-tags="🇮🇹"><span id="c-🇮🇹"
                        class="badge text-bg-light rounded-pill font-monospace">&nbsp;</span></a>
                <a href="#" id="🇬🇧" class="btn svg-background" role="button" data-bs-toggle="button" data-tags="🇬🇧"><span id="c-🇬🇧"
                        class="badge text-bg-light rounded-pill font-monospace">&nbsp;</span></a>
                <a href="#" id="🇩🇪" class="btn svg-background" role="button" data-bs-toggle="button" data-tags="🇩🇪"><span id="c-🇩🇪"
                        class="badge text-bg-light rounded-pill font-monospace">&nbsp;</span></a>
                <a href="#" id="🇵🇹" class="btn svg-background" role="button" data-bs-toggle="button" data-tags="🇵🇹"><span id="c-🇵🇹"
                        class="badge text-bg-light rounded-pill font-monospace">&nbsp;</span></a>
                <a href="#" id="🇪🇸" class="btn svg-background" role="button" data-bs-toggle="button" data-tags="🇪🇸"><span id="c-🇪🇸"
                        class="badge text-bg-light rounded-pill font-monospace">&nbsp;</span></a>
            </div>
        </div>
        <div id="tags" class="category">
            <div class="image-container">
                <a href="#" id="2_guerre" class="btn" role="button" data-bs-toggle="button" data-tags="nazi">2ᵉ guerre</a>
                <a href="#" id="amerique" class="btn" role="button" data-bs-toggle="button" data-tags="amerique">Amérique</a>
                <a href="#" id="arbres" class="btn" role="button" data-bs-toggle="button" data-tags="arbres">Arbres <span style="font-size: smaller;">🌳</span></a>
                <a href="#" id="bach" class="btn" role="button" data-bs-toggle="button" data-tags="bach">Bach</a>
                <a href="#" id="bd" class="btn" role="button" data-bs-toggle="button" data-tags="bd fumetto manga tintin tintin_etc">BD</a>
                <a href="#" id="beau_livre" class="btn" role="button" data-bs-toggle="button" data-tags="beau_livre arts arts_bis">Beaux livres</a>
                <a href="#" id="berlusconneries" class="btn" role="button" data-bs-toggle="button" data-tags="berlusconneries">Berlusconneries</a>
                <a href="#" id="biographie" class="btn" role="button" data-bs-toggle="button" data-tags="biographie">Biographie</a>
                <a href="#" id="celine" class="btn" role="button" data-bs-toggle="button" data-tags="celine">Céline</a>
                <a href="#" id="cinema" class="btn" role="button" data-bs-toggle="button" data-tags="cinema">Cinéma <span style="font-size: smaller;">🎥</span></a>
                <a href="#" id="cuisine" class="btn" role="button" data-bs-toggle="button" data-tags="cuisine">Cuisine</a>
                <a href="#" id="chess" class="btn" role="button" data-bs-toggle="button" data-tags="chess">Échecs <span style="font-size: larger;">♘</span></a>
                <a href="#" id="editor" class="btn" role="button" data-bs-toggle="button" data-tags="editor">Editeurs</a>
                <a href="#" id="editori" class="btn" role="button" data-bs-toggle="button" data-tags="editori">Editori</a>
                <a href="#" id="enfer" class="btn" role="button" data-bs-toggle="button" data-tags="enfer">Enfer</a>
                <a href="#" id="folio" class="btn" role="button" data-bs-toggle="button" data-tags="folio">Folio</a>
                <a href="#" id="football" class="btn" role="button" data-bs-toggle="button" data-tags="football">Foot <span style="font-size: smaller;">⚽</span></a>
                <a href="#" id="kafka" class="btn" role="button" data-bs-toggle="button" data-tags="kafka">Kafka</a>
                <a href="#" id="lapleiade" class="btn" role="button" data-bs-toggle="button" data-tags="lapleiade">La Pléiade</a>
                <a href="#" id="mozart" class="btn" role="button" data-bs-toggle="button" data-tags="mozart">Mozart</a>
                <a href="#" id="musique" class="btn" role="button" data-bs-toggle="button" data-tags="music bach mozart">Musique <span style="font-size: larger;">𝄞</span></a>
                <a href="#" id="paris" class="btn" role="button" data-bs-toggle="button" data-tags="paris">Paris</a>
                <a href="#" id="perec" class="btn" role="button" data-bs-toggle="button" data-tags="perec">Perec</a>
                <a href="#" id="philo" class="btn" role="button" data-bs-toggle="button" data-tags="philo">Philo</a>
                <a href="#" id="poesie" class="btn" role="button" data-bs-toggle="button" data-tags="poésie rimbaud">Poésie</a>
                <a href="#" id="polar" class="btn" role="button" data-bs-toggle="button" data-tags="polar pdjames">Polar</a>
                <a href="#" id="proust" class="btn" role="button" data-bs-toggle="button" data-tags="proust">Proust</a>
                <a href="#" id="rimbaud" class="btn" role="button" data-bs-toggle="button" data-tags="rimbaud">Rimbaud</a>
                <a href="#" id="roth" class="btn" role="button" data-bs-toggle="button" data-tags="roth">Roth</a>
                <a href="#" id="rowling" class="btn" role="button" data-bs-toggle="button" data-tags="rowling">Rowling</a>
                <a href="#" id="schloss" class="btn" role="button" data-bs-toggle="button" data-tags="schloss">Das Schloß <span style="font-size: larger;">♖</span></a>
                <a href="#" id="small" class="btn" role="button" data-bs-toggle="button" data-tags="small">Small</a>
                <a href="#" id="theatre" class="btn" role="button" data-bs-toggle="button" data-tags="théatre">Théatre</a>
                <a href="#" id="tintin" class="btn" role="button" data-bs-toggle="button" data-tags="tintin tintin_etc">Tintin</a>
            </div>
        </div>
        <div id="color" class="category">
            <div class="image-container">
                <a href="#" id="black" class="color btn" role="button" data-bs-toggle="button" data-tags="Black"><span class="color_black">⬤</span></a>
                <a href="#" id="white" class="color btn" role="button" data-bs-toggle="button" data-tags="White"><span class="color_white">⬤</span></a>
                <a href="#" id="gray" class="color btn" role="button" data-bs-toggle="button" data-tags="Gray"><span class="color_gray">⬤</span></a>
                <a href="#" id="red" class="color btn" role="button" data-bs-toggle="button" data-tags="Red"><span class="color_red">⬤</span></a>
                <a href="#" id="yellow" class="color btn" role="button" data-bs-toggle="button" data-tags="Yellow"><span class="color_yellow">⬤</span></a>
                <a href="#" id="green" class="color btn" role="button" data-bs-toggle="button" data-tags="Green"><span class="color_green">⬤</span></a>
                <a href="#" id="cyan" class="color btn" role="button" data-bs-toggle="button" data-tags="Cyan"><span class="color_cyan">⬤</span></a>
                <a href="#" id="blue" class="color btn" role="button" data-bs-toggle="button" data-tags="Blue"><span class="color_blue">⬤</span></a>
                <a href="#" id="magenta" class="color btn" role="button" data-bs-toggle="button" data-tags="Magenta"><span class="color_magenta">⬤</span></a>
                <a href="#" id="rainbow" class="color btn" role="button" data-bs-toggle="button" data-tags="Rainbow"><span class="color_rainbow">
                    <img src="svg/Color_circle_(RGB).svg" style="width:14px; height: auto;">
                </span></a>
            </div>
        </div>
        <div id="date" class="category" style="display: none;">
            <a href="#" id="_1400" class="btn" role="button" data-bs-toggle="button"
                data-tags="_1400 _1401 _1402 _1403 _1404 _1405 _1406 _1407 _1408 _1409 _1410 _1411 _1412 _1413 _1414 _1415 _1416 _1417 _1418 _1419 _1420 _1421 _1422 _1423 _1424 _1425 _1426 _1427 _1428 _1429 _1430 _1431 _1432 _1433 _1434 _1435 _1436 _1437 _1438 _1439 _1440 _1441 _1442 _1443 _1444 _1445 _1446 _1447 _1448 _1449 _1450 _1451 _1452 _1453 _1454 _1455 _1456 _1457 _1458 _1459 _1460 _1461 _1462 _1463 _1464 _1465 _1466 _1467 _1468 _1469 _1470 _1471 _1472 _1473 _1474 _1475 _1476 _1477 _1478 _1479 _1480 _1481 _1482 _1483 _1484 _1485 _1486 _1487 _1488 _1489 _1490 _1491 _1492 _1493 _1494 _1495 _1496 _1497 _1498 _1499">1400'</a>
            <a href="#" id="_1500" class="btn" role="button" data-bs-toggle="button"
                data-tags="_1500 _1501 _1502 _1503 _1504 _1505 _1506 _1507 _1508 _1509 _1510 _1511 _1512 _1513 _1514 _1515 _1516 _1517 _1518 _1519 _1520 _1521 _1522 _1523 _1524 _1525 _1526 _1527 _1528 _1529 _1530 _1531 _1532 _1533 _1534 _1535 _1536 _1537 _1538 _1539 _1540 _1541 _1542 _1543 _1544 _1545 _1546 _1547 _1548 _1549 _1550 _1551 _1552 _1553 _1554 _1555 _1556 _1557 _1558 _1559 _1560 _1561 _1562 _1563 _1564 _1565 _1566 _1567 _1568 _1569 _1570 _1571 _1572 _1573 _1574 _1575 _1576 _1577 _1578 _1579 _1580 _1581 _1582 _1583 _1584 _1585 _1586 _1587 _1588 _1589 _1590 _1591 _1592 _1593 _1594 _1595 _1596 _1597 _1598 _1599">1500'</a>
            <a href="#" id="_1600" class="btn" role="button" data-bs-toggle="button"
                data-tags="_1600 _1601 _1602 _1603 _1604 _1605 _1606 _1607 _1608 _1609 _1610 _1611 _1612 _1613 _1614 _1615 _1616 _1617 _1618 _1619 _1620 _1621 _1622 _1623 _1624 _1625 _1626 _1627 _1628 _1629 _1630 _1631 _1632 _1633 _1634 _1635 _1636 _1637 _1638 _1639 _1640 _1641 _1642 _1643 _1644 _1645 _1646 _1647 _1648 _1649 _1650 _1651 _1652 _1653 _1654 _1655 _1656 _1657 _1658 _1659 _1660 _1661 _1662 _1663 _1664 _1665 _1666 _1667 _1668 _1669 _1670 _1671 _1672 _1673 _1674 _1675 _1676 _1677 _1678 _1679 _1680 _1681 _1682 _1683 _1684 _1685 _1686 _1687 _1688 _1689 _1690 _1691 _1692 _1693 _1694 _1695 _1696 _1697 _1698 _1699">1600'</a>
            <a href="#" id="_1700" class="btn" role="button" data-bs-toggle="button"
                data-tags="_1700 _1701 _1702 _1703 _1704 _1705 _1706 _1707 _1708 _1709 _1710 _1711 _1712 _1713 _1714 _1715 _1716 _1717 _1718 _1719 _1720 _1721 _1722 _1723 _1724 _1725 _1726 _1727 _1728 _1729 _1730 _1731 _1732 _1733 _1734 _1735 _1736 _1737 _1738 _1739 _1740 _1741 _1742 _1743 _1744 _1745 _1746 _1747 _1748 _1749 _1750 _1751 _1752 _1753 _1754 _1755 _1756 _1757 _1758 _1759 _1760 _1761 _1762 _1763 _1764 _1765 _1766 _1767 _1768 _1769 _1770 _1771 _1772 _1773 _1774 _1775 _1776 _1777 _1778 _1779 _1780 _1781 _1782 _1783 _1784 _1785 _1786 _1787 _1788 _1789 _1790 _1791 _1792 _1793 _1794 _1795 _1796 _1797 _1798 _1799">1700'</a>
            <a href="#" id="_1800" class="btn" role="button" data-bs-toggle="button"
                data-tags="_1800 _1801 _1802 _1803 _1804 _1805 _1806 _1807 _1808 _1809 _1810 _1811 _1812 _1813 _1814 _1815 _1816 _1817 _1818 _1819 _1820 _1821 _1822 _1823 _1824 _1825 _1826 _1827 _1828 _1829 _1830 _1831 _1832 _1833 _1834 _1835 _1836 _1837 _1838 _1839 _1840 _1841 _1842 _1843 _1844 _1845 _1846 _1847 _1848 _1849 _1850 _1851 _1852 _1853 _1854 _1855 _1856 _1857 _1858 _1859 _1860 _1861 _1862 _1863 _1864 _1865 _1866 _1867 _1868 _1869 _1870 _1871 _1872 _1873 _1874 _1875 _1876 _1877 _1878 _1879 _1880 _1881 _1882 _1883 _1884 _1885 _1886 _1887 _1888 _1889 _1890 _1891 _1892 _1893 _1894 _1895 _1896 _1897 _1898 _1899">1800'</a>
            <!--br-->
            <a href="#" id="_1900" class="btn" role="button" data-bs-toggle="button" data-tags="_1900 _1901 _1902 _1903 _1904 _1905 _1906 _1907 _1908 _1909">1900'</a>
            <a href="#" id="_1910" class="btn" role="button" data-bs-toggle="button" data-tags="_1910 _1911 _1912 _1913 _1914 _1915 _1916 _1917 _1918 _1919">1910'</a>
            <a href="#" id="_1920" class="btn" role="button" data-bs-toggle="button" data-tags="_1920 _1921 _1922 _1923 _1924 _1925 _1926 _1927 _1928 _1929">1920'</a>
            <a href="#" id="_1930" class="btn" role="button" data-bs-toggle="button" data-tags="_1930 _1931 _1932 _1933 _1934 _1935 _1936 _1937 _1938 _1939">1930'</a>
            <a href="#" id="_1940" class="btn" role="button" data-bs-toggle="button" data-tags="_1940 _1941 _1942 _1943 _1944 _1945 _1946 _1947 _1948 _1949">1940'</a>
            <a href="#" id="_1950" class="btn" role="button" data-bs-toggle="button" data-tags="_1950 _1951 _1952 _1953 _1954 _1955 _1956 _1957 _1958 _1959">1950'</a>
            <a href="#" id="_1960" class="btn" role="button" data-bs-toggle="button" data-tags="_1960 _1961 _1962 _1963 _1964 _1965 _1966 _1967 _1968 _1969">1960'</a>
            <a href="#" id="_1970" class="btn" role="button" data-bs-toggle="button" data-tags="_1970 _1971 _1972 _1973 _1974 _1975 _1976 _1977 _1978 _1979">1970'</a>
            <a href="#" id="_1980" class="btn" role="button" data-bs-toggle="button" data-tags="_1980 _1981 _1982 _1983 _1984 _1985 _1986 _1987 _1988 _1989">1980'</a>
            <a href="#" id="_1990" class="btn" role="button" data-bs-toggle="button" data-tags="_1990 _1991 _1992 _1993 _1994 _1995 _1996 _1997 _1998 _1999">1990'</a>
            <a href="#" id="_2000" class="btn" role="button" data-bs-toggle="button" data-tags="_2000 _2001 _2002 _2003 _2004 _2005 _2006 _2007 _2008 _2009">2000'</a>
            <!--br-->
            <a href="#" id="_2010" class="btn" role="button" data-bs-toggle="button" data-tags="_2010">2010</a>
            <a href="#" id="_2011" class="btn" role="button" data-bs-toggle="button" data-tags="_2011">2011</a>
            <a href="#" id="_2012" class="btn" role="button" data-bs-toggle="button" data-tags="_2012">2012</a>
            <a href="#" id="_2013" class="btn" role="button" data-bs-toggle="button" data-tags="_2013">2013</a>
            <a href="#" id="_2014" class="btn" role="button" data-bs-toggle="button" data-tags="_2014">2014</a>
            <a href="#" id="_2015" class="btn" role="button" data-bs-toggle="button" data-tags="_2015">2015</a>
            <a href="#" id="_2016" class="btn" role="button" data-bs-toggle="button" data-tags="_2016">2016</a>
            <a href="#" id="_2017" class="btn" role="button" data-bs-toggle="button" data-tags="_2017">2017</a>
            <a href="#" id="_2018" class="btn" role="button" data-bs-toggle="button" data-tags="_2018">2018</a>
            <a href="#" id="_2019" class="btn" role="button" data-bs-toggle="button" data-tags="_2019">2019</a>
            <a href="#" id="_2020" class="btn" role="button" data-bs-toggle="button" data-tags="_2020">2020</a>
            <a href="#" id="_2021" class="btn" role="button" data-bs-toggle="button" data-tags="_2021">2021</a>
            <a href="#" id="_2022" class="btn" role="button" data-bs-toggle="button" data-tags="_2022">2022</a>
            <a href="#" id="_2023" class="btn" role="button" data-bs-toggle="button" data-tags="_2023">2023</a>
        </div>
        <div id="letters" class="category">
            <div class="image-container">
                <a href="#" id="_A_" class="btn" role="button" data-bs-toggle="button" data-tags="_A_">A</a>
                <a href="#" id="_B_" class="btn" role="button" data-bs-toggle="button" data-tags="_B_">B</a>
                <a href="#" id="_C_" class="btn" role="button" data-bs-toggle="button" data-tags="_C_">C</a>
                <a href="#" id="_D_" class="btn" role="button" data-bs-toggle="button" data-tags="_D_">D</a>
                <a href="#" id="_E_" class="btn" role="button" data-bs-toggle="button" data-tags="_E_">E</a>
                <a href="#" id="_F_" class="btn" role="button" data-bs-toggle="button" data-tags="_F_">F</a>
                <a href="#" id="_G_" class="btn" role="button" data-bs-toggle="button" data-tags="_G_">G</a>
                <a href="#" id="_H_" class="btn" role="button" data-bs-toggle="button" data-tags="_H_">H</a>
                <a href="#" id="_I_" class="btn" role="button" data-bs-toggle="button" data-tags="_I_">I</a>
                <a href="#" id="_J_" class="btn" role="button" data-bs-toggle="button" data-tags="_J_">J</a>
                <a href="#" id="_K_" class="btn" role="button" data-bs-toggle="button" data-tags="_K_">K</a>
                <a href="#" id="_L_" class="btn" role="button" data-bs-toggle="button" data-tags="_L_">L</a>
                <a href="#" id="_M_" class="btn" role="button" data-bs-toggle="button" data-tags="_M_">M</a>
                <a href="#" id="_N_" class="btn" role="button" data-bs-toggle="button" data-tags="_N_">N</a>
                <a href="#" id="_O_" class="btn" role="button" data-bs-toggle="button" data-tags="_O_">O</a>
                <a href="#" id="_P_" class="btn" role="button" data-bs-toggle="button" data-tags="_P_">P</a>
                <a href="#" id="_Q_" class="btn" role="button" data-bs-toggle="button" data-tags="_Q_">Q</a>
                <a href="#" id="_R_" class="btn" role="button" data-bs-toggle="button" data-tags="_R_">R</a>
                <a href="#" id="_S_" class="btn" role="button" data-bs-toggle="button" data-tags="_S_">S</a>
                <a href="#" id="_T_" class="btn" role="button" data-bs-toggle="button" data-tags="_T_">T</a>
                <a href="#" id="_U_" class="btn" role="button" data-bs-toggle="button" data-tags="_U_">U</a>
                <a href="#" id="_V_" class="btn" role="button" data-bs-toggle="button" data-tags="_V_">V</a>
                <a href="#" id="_X_" class="btn" role="button" data-bs-toggle="button" data-tags="_X_">X</a>
                <a href="#" id="_Y_" class="btn" role="button" data-bs-toggle="button" data-tags="_Y_">Y</a>
                <a href="#" id="_Z_" class="btn" role="button" data-bs-toggle="button" data-tags="_Z_">Z</a>
            </div>
        </div>
        <div id="figuresContainer" class="image-container"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.min.js"></script>
    <script>
        Handlebars.registerHelper('calculatePercentage', function (dividend, divisor) {
            if (!divisor || divisor === 0) {
                return 0; // avoid division by zero or undefined
            }

            return (dividend / divisor) * 100;
        });
    </script>
    <script>
        // function to set --background-image based on ID
        function setSVGBackgrounds(selector) {
            // get all elements matching the selector
            const elements = document.querySelectorAll(selector);

            // iterate over the elements and set the --background-image variable
            elements.forEach(function (element) {
                const id = element.id;
                if (id) {
                    // directly use the template literal within setProperty
                    element.style.setProperty('--background-image', `url("svg/flags/${id}.svg")`);
                }
            });
        }

        // call the function with your specific selector
        setSVGBackgrounds('.svg-background');
    </script>

    <script type="module">
        import jsYaml from 'https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/+esm'
        import acColors from 'https://cdn.jsdelivr.net/npm/ac-colors@1.4.3/+esm'
        import { deltaE } from 'https://cdn.jsdelivr.net/npm/color-delta-e@1.3.0/+esm'
        import colorSpace from 'https://cdn.jsdelivr.net/npm/color-space@2.0.1/+esm'

        const urlParams = new URLSearchParams(window.location.search);
        const filterParam = urlParams.get('f');

        const container = document.getElementById("container")
        let booksFiltered
        let total_des_totaux = undefined

        function calculateWeightedAverageChroma(palette) {
            let totalWeightedChroma = 0
            let totalWeight = 0

            for (const color of palette) {
                const lab = colorSpace.rgb.lab(color.color)
                const chroma = Math.sqrt(Math.pow(lab[1], 2) + Math.pow(lab[2], 2))
                const weightedChroma = chroma * color.count
                totalWeightedChroma += weightedChroma
                totalWeight += color.count
            }

            const weightedAverageChroma = totalWeightedChroma / totalWeight
            return weightedAverageChroma
        }

        function calculateAverageLuminance(palette) {
            let totalWeightedLuminance = 0
            let totalWeight = 0

            for (const color of palette) {
                const lab = colorSpace.rgb.lab(color.color)
                const weightedLuminance = lab[0] * color.count
                totalWeightedLuminance += weightedLuminance
                totalWeight += color.count
            }

            const weightedAverageLuminance = totalWeightedLuminance / totalWeight
            return weightedAverageLuminance
        }

        function palette_diversity(palette) {
            // calculate the color differences between all pairs of colors
            let totalDifference = 0
            let pairCount = 0
            const diversity = {}
            let totalWeightedDeltaE = 0
            let weightNorm = 0
            let weightVariance = 0

            // calculate the mean (average) weight of colors in the set
            let meanWeight = 0
            for (const color of palette) {
                meanWeight += color.count
            }
            meanWeight /= palette.length

            for (let i = 0; i < palette.length; i++) {
                for (let j = i + 1; j < palette.length; j++) {

                    const color1 = palette[i]
                    const color2 = palette[j]

                    // calculate CIELAB ΔE between the two colors
                    // const _deltaE = chroma.deltaE(color1.color, color2.color)
                    const _deltaE = deltaE(color1.color, color2.color)

                    // console.log(_deltaE, _deltaE2)

                    // calculate the weighted ΔE for the pair
                    const weightedDeltaE = _deltaE * (color1.count * color2.count)

                    const key = "_" + i + j
                    diversity[key] = weightedDeltaE

                    // add the weighted ΔE to the total
                    totalWeightedDeltaE += weightedDeltaE

                    // add the square of the weight to weightNorm
                    weightNorm += Math.pow(color1.count, 2) + Math.pow(color2.count, 2)

                    // calculate the weight deviation from the mean and add it to the weightVariance
                    let weightDeviation = color1.count - meanWeight
                    weightVariance += weightDeviation * weightDeviation
                    weightDeviation = color2.count - meanWeight
                    weightVariance += weightDeviation * weightDeviation
                }
            }

            const weightVarianceScalingFactor = 0.1

            // calculate the average color difference as the diversity indicator
            const diversityIndex = (totalWeightedDeltaE / (1 + weightVariance)) * weightNorm * weightVarianceScalingFactor
            diversity["total"] = diversityIndex
            return diversity
        }

        class Counter {
            total = 0
            sgl = 0
            slds = 0
            en = 0
            it = 0
            fr = 0
            de = 0
            pt = 0
            sp = 0
            count = (entry) => {
                switch (entry.lan) {
                    case '🇬🇧':
                        this.en++
                        break
                    case '🇮🇹':
                        this.it++
                        break
                    case '🇫🇷':
                        this.fr++
                        break
                    case '🇩🇪':
                        this.de++
                        break
                    case '🇵🇹':
                        this.pt++
                        break
                    case '🇪🇸':
                        this.sp++
                        break
                    default:
                        console.error("missing lan property", entry)
                }
                if (entry.where.includes("lipion")) {
                    this.sgl++
                } else {
                    this.slds++
                }
                this.total++
            }

            display = () => {
                if (typeof total_des_totaux === "undefined") {
                    total_des_totaux = this.total
                }
                // total
                document.getElementById("current").innerHTML = `${this.total}`
                // percent
                let percent = total_des_totaux !== 0 ? this.total / total_des_totaux : 1
                if (percent === 1) {
                    document.getElementById("current").classList.add('neonText')
                    circle_with_cross.style.visibility = "hidden"
                } else {
                    document.getElementById("current").classList.remove('neonText')
                    circle_with_cross.style.visibility = "visible"
                }
                document.getElementById("percent").innerHTML = `${Number(percent).toLocaleString(undefined, { style: 'percent', minimumFractionDigits: 1 })}`
                // langage
                const flags = { fr: '🇫🇷', it: '🇮🇹', en: '🇬🇧', de: '🇩🇪', pt: '🇵🇹', sp: '🇪🇸' }
                for (const [key, value] of Object.entries(flags)) {
                    const elem = document.getElementById(`c-${value}`)
                    if (elem && elem.parentNode) {
                        const isActive = elem.parentNode.classList.contains('active')
                        const categoryAncestor = findAncestorWithClass(elem, "category")
                        const isCategoryAncestorActive = categoryAncestor ? categoryAncestor.classList.contains('active') : false;
                        if (this[key] !== 0 || isActive || isCategoryAncestorActive || typeof categories.langage === 'undefined') {
                            elem.style.visibility = 'visible'
                            elem.innerHTML = this[key]
                        } else {
                            elem.style.visibility = 'hidden'
                            elem.innerHTML = '&bnsp;'
                        }
                    }
                }
                // location
                document.getElementById("c-saint-jean-lipion").innerHTML = `${this.sgl}`
                document.getElementById("c-saint-lazare-de-savene").innerHTML = `${this.slds}`
            }

        }

        // define a function to classify the image based on base variables
        function classifyImage(baseVariables) {
            const dominantColorHue = baseVariables.dominantColorHSL[0]
            const weightedAverageChroma = calculateWeightedAverageChroma(baseVariables.palette)
            const averageLuminance = calculateAverageLuminance(baseVariables.palette)

            if (averageLuminance < 45 && weightedAverageChroma < 15) {
                return "Black"
            } else if (averageLuminance >= 45 && averageLuminance < 82 && weightedAverageChroma < 3.85) {
                return "Gray"
            } else if (averageLuminance >= 82 && averageLuminance <= 100 && weightedAverageChroma < 3.1) {
                return "White"
            }

            // rainbow
            if (11000000000 <= baseVariables.palette_diversity.total) {
                return "Rainbow"
            }

            // hue
            {
                // define a threshold for hue values (adjust as needed)
                const averageHue = dominantColorHue

                const hueThresholdLeft = 18
                const hueThresholdRight = 12


                let averageHue180 = averageHue / 2
                if (0 <= averageHue180 && averageHue180 < hueThresholdRight + 3) {
                    return "Red"
                } else if ((30 - 3 - hueThresholdLeft <= averageHue180 && averageHue180 < 30 - 4 + hueThresholdRight)) {
                    return "Yellow"
                } else if (60 - 4 - hueThresholdLeft <= averageHue180 && averageHue180 < 60 + hueThresholdRight) {
                    return "Green"
                } else if (90 - hueThresholdLeft <= averageHue180 && averageHue180 < 90 + hueThresholdRight) {
                    return "Cyan"
                } else if (120 - hueThresholdLeft <= averageHue180 && averageHue180 < 120 + hueThresholdRight) {
                    return "Blue"
                } else if (150 - hueThresholdLeft <= averageHue180 && averageHue180 < 150 + hueThresholdRight) {
                    return "Magenta"
                } else {
                    return "Red"
                }
            }
            return "Unknown"
        }


        const categories = {
            langage: undefined,
            location: undefined,
            tags: undefined,
            color: undefined,
            date: undefined,
            letters: undefined
        }

        function findAncestorWithClass(element, className) {
            let parent = element.parentNode;

            while (parent && !parent.classList.contains(className)) {
                parent = parent.parentNode;
            }

            return parent; // returns the parent with the specified class or null if not found
        }

        function selectOrUnselectTag(e) {

            const thisElem = e.currentTarget
            const id = thisElem.id
            const className = thisElem.className
            const tags = thisElem.dataset.tags.split(' ')
            const categoryElem = findAncestorWithClass(thisElem, "category")
            const category = categoryElem.id
            console.log(categoryElem.id)

            const allBtns = document.getElementsByClassName("btn")
            for (const btn of allBtns) {
                if (btn.id === id) {
                    continue
                }
                if (findAncestorWithClass(btn, "category").id !== category) {
                    continue
                }
                btn.classList.remove("active")
            }

            const figures = document.querySelectorAll('figure')
            const c = new Counter()

            if (className.includes('active')) {
                categories[category] = tags
                e.currentTarget.parentNode.classList.add('active')
            } else {
                categories[category] = undefined
                e.currentTarget.parentNode.classList.remove('active')
            }

            // "J'éteins"
            for (const figure of figures) {
                figure.style.display = "none"
            }

            // *** BEGIN made by ChatGPT ***
            function generateSelector(definedCategories) {
                const rules = definedCategories.split(';').filter(line => line.trim() !== '')
                const categories = rules.map(rule => rule.split(',').map(tag => `.${tag.trim()}`))
                const combinations = cartesianProduct(...categories)

                return combinations.map(combination => combination.join('')).join(',').trim()
            }

            // helper function to find the Cartesian product of multiple arrays
            function cartesianProduct(...arrays) {
                return arrays.reduce((accumulator, array) => {
                    return accumulator.flatMap(a => array.map(b => a.concat(b)))
                }, [[]])
            }
            // *** END made by ChatGPT ***

            const definedCategoriesArray = Object.values(categories).filter(categoryValue => {
                return categoryValue && categoryValue.length > 0 ? categoryValue : false
            })

            let definedCategories = definedCategoriesArray.join(";")
            let selector = generateSelector(definedCategories)

            if (selector) {
                const taggeds = document.querySelectorAll(selector)
                for (const tagged of taggeds) {
                    c.count(booksFiltered[tagged.dataset.index][1])
                    tagged.style.display = "inline-block"
                }
            } else {
                for (const figure of figures) {
                    c.count(booksFiltered[figure.dataset.index][1])
                    figure.style.display = "inline-block"
                }
            }

            c.display()
        }

        const allBtns = document.querySelectorAll(".btn:not(#circle_with_cross)")
        for (const btn of allBtns) {
            btn.addEventListener("click", selectOrUnselectTag)
        }

        circle_with_cross.addEventListener("click", () => {
            const allBtns = document.querySelectorAll(".btn,.category")
            for (const btn of allBtns) {
                btn.classList.remove("active")
            }
            Object.keys(categories).forEach(function (key, index) {
                categories[key] = undefined
            })
            const figures = document.querySelectorAll('figure')
            const c = new Counter()
            for (const figure of figures) {
                c.count(booksFiltered[figure.dataset.index][1])
                figure.style.display = "inline-block"
            }
            c.display()
        })

        const response = await fetch('./index-book-template.hbs');
        const templateSource = await response.text();
        const template = Handlebars.compile(templateSource);

        function blend(index, isbn, book) {

            const context = {
                index,
                isbn,
                book,
                author: book.de.split(/ \(/)[0],
                imageClass: classifyImage(book.cover),
                lipion: book.where.includes('lipion'),
            };

            const html = template(context);
            const fragment = document.createRange().createContextualFragment(html);

            // append the generated HTML to your container
            figuresContainer.appendChild(fragment);
            const loadingElement = document.getElementById('loading')
            loadingElement.style.display = 'none'
        }

        function updateDisplay(text) {
            const doc = jsYaml.load(text, 'utf8')

            {
                const books = Object.entries(doc)

                booksFiltered = books.filter((e) => {
                    if (filterParam) {
                        return e[0] === filterParam
                    } else {
                        return true
                    }
                    /*
                    return e[0] === "978-3551732248"
                    */
                })
            }

            for (const bookIndex in booksFiltered) {
                const isbn = booksFiltered[bookIndex][0]
                // console.log(isbn)
                const book = booksFiltered[bookIndex][1]
                book.cover.palette = JSON.parse(book.cover.palette.replaceAll("'", '"'))
                book.cover.palette.sort((a, b) => b.count - a.count)
                book.cover.paletteSize = book.cover.palette.reduce((accumulator, currentValue) => accumulator + currentValue.count, 0)

                const dominantColor = book.cover.palette[0].color
                const dominantColorHSL = acColors.rgbToHsl(dominantColor)
                book.cover.dominantColor = dominantColor
                book.cover.dominantColorHSL = dominantColorHSL
                book.cover.hue = dominantColorHSL[0]
                book.cover.saturation = dominantColorHSL[1]
                book.cover.lightness = dominantColorHSL[2]

                book.cover.palette_diversity = palette_diversity(book.cover.palette)

                if (typeof book.tags !== "undefined") {
                    const name = book.de.split(/ \(/)[0]
                    const split = name.split(/ /)
                    const lastname = split[split.length - 1]
                    const lastnameinitial = lastname.charAt(0).toUpperCase()
                    book.tags.push(`_${lastnameinitial}_`)
                }
            }

            booksFiltered.sort((a, b) => {
                try {
                    /*
                    const palA = +a[1].cover.palette_diversity.total
                    const palB = +b[1].cover.palette_diversity.total
                    const monoA = +a[1].cover.monochrome2
                    const monoB = +b[1].cover.monochrome2
                    const A = +a[1].cover.lightness
                    const B = +b[1].cover.lightness
                    const lumA = +a[1].cover.mean_lightness
                    const lumB = +b[1].cover.mean_lightness
                    const stdLumA = +a[1].cover.std_lightness
                    const stdLumB = +b[1].cover.std_lightness
                    let critA
                    let critB
                    
                    {
                        critA = palA
                        critB = palB
                        if (critA != critB) {
                            return critA - critB
                        }
                    }
                    {
                        critA = lumA
                        critB = lumB
                        if (critA != critB) {
                            return critB - critA
                        }
                    }
                    {
                        critA = stdLumA
                        critB = stdLumB
                        if (critA != critB) {
                            return critB - critA
                        }
                    }
                    */


                    const nameA = a[1].de.toUpperCase().split(/ \(/)[0]
                    const nameB = b[1].de.toUpperCase().split(/ \(/)[0]
                    const splitA = nameA.split(/ /)
                    const splitB = nameB.split(/ /)
                    const lastnameA = splitA[splitA.length - 1]
                    const lastnameB = splitB[splitB.length - 1]
                    const lastnameDifference = lastnameA.localeCompare(lastnameB)
                    if (lastnameDifference !== 0) {
                        return lastnameDifference
                    }
                    const nameDifference = nameA.localeCompare(nameB)
                    if (nameDifference !== 0) {
                        return nameDifference
                    }
                    if (typeof a[1].title === "undefined" || typeof b[1].title === "undefined") {
                        console.log("boum!")
                        return 0
                    }
                    const titleA = a[1].title.toUpperCase()
                    const titleB = b[1].title.toUpperCase()
                    return titleA.localeCompare(titleB)
                } catch (error) {
                    console.error(a, b)
                    return 0
                }
            })

            const c = new Counter()
            for (const bookIndex in booksFiltered) {
                const bookEntry = booksFiltered[bookIndex]
                const isbn = bookEntry[0]
                const book = bookEntry[1]

                const enableSkip = undefined // "tintin" // "Kafka" // "Perec" // 
                let skip = typeof enableSkip !== "undefined"
                if (typeof book.tags !== "undefined") {
                    if (enableSkip) {
                        skip = !book.tags.includes(enableSkip)
                    }
                    if (book.tags.includes("verboten")) {
                        skip = true
                        console.log("SKIP", book.de, book.tags)
                    }
                }

                if (!skip) {
                    blend(bookIndex, isbn, book)
                    c.count(book)
                } else {
                    // console.log(book)
                }
            }
            c.display()
        }

        function fetchData() {
            const xhr = new XMLHttpRequest()
            xhr.open("GET", "dist/everything.yaml", true)
            xhr.onload = () => {
                updateDisplay(xhr.response)
            }
            xhr.send()
        }

        fetchData()

    </script>
</body>

</html>