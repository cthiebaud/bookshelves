<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bookshelves</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        figure:after {
            content: "";
            /* This is necessary for the pseudo element to work. */
            display: block;
            /* This will put the pseudo element on its own line. */
            margin: 0 auto;
            /* This will center the border. */
            width: 84%;
            /* Change this to whatever width you want. */
            padding-top: 20px;
            /* This creates some space between the element and the border. */
            border-bottom: 1px solid lightgray;
            /* This creates the border. Replace black with whatever color you want. */
        }

        .figure-img {
            margin-bottom: 0.25rem;
        }

        .counter {
            /* display: none; */
        }
    </style>
</head>

<body>
    <div id="container" class="container-fluid">
        <h1 id="howmuch" class="counter" style="text-align: center;">â€¦</h1>
        <div class="counter" style="text-align: center;">
            <a href="#" id="ðŸ‡«ðŸ‡·" class="btn" role="button" data-bs-toggle="button" data-tags="ðŸ‡«ðŸ‡·"> ðŸ‡«ðŸ‡· <span id="c-ðŸ‡«ðŸ‡·"></span> </a>
            <a href="#" id="ðŸ‡®ðŸ‡¹" class="btn" role="button" data-bs-toggle="button" data-tags="ðŸ‡®ðŸ‡¹"> ðŸ‡®ðŸ‡¹ <span id="c-ðŸ‡®ðŸ‡¹"></span> </a>
            <a href="#" id="ðŸ‡¬ðŸ‡§" class="btn" role="button" data-bs-toggle="button" data-tags="ðŸ‡¬ðŸ‡§"> ðŸ‡¬ðŸ‡§ <span id="c-ðŸ‡¬ðŸ‡§"></span> </a>
            <a href="#" id="ðŸ‡©ðŸ‡ª" class="btn" role="button" data-bs-toggle="button" data-tags="ðŸ‡©ðŸ‡ª"> ðŸ‡©ðŸ‡ª <span id="c-ðŸ‡©ðŸ‡ª"></span> </a>
            <a href="#" id="ðŸ‡µðŸ‡¹" class="btn" role="button" data-bs-toggle="button" data-tags="ðŸ‡µðŸ‡¹"> ðŸ‡µðŸ‡¹ <span id="c-ðŸ‡µðŸ‡¹"></span> </a>
        </div>
        <div class="counter" style="text-align: center;">
            <a href="#" id="saint-lazare-de-savene" class="btn" role="button" data-bs-toggle="button" data-tags="saint-lazare-de-savene">
                San Lazzaro
                <span id="c-saint-lazare-de-savene"></span>
                â†‘
            </a>
            <a href="#" id="saint-jean-lipion" class="btn" role="button" data-bs-toggle="button" data-tags="saint-jean-lipion">
                â†“
                <span id="c-saint-jean-lipion"></span>
                San Giovanni
            </a>
        </div>
        <div class="counter" style="text-align: center;">
            <a href="#" id="cinema" class="btn" role="button" data-bs-toggle="button" data-tags="cinema">CinÃ©ma</a>
            <a href="#" id="cuisine" class="btn" role="button" data-bs-toggle="button" data-tags="cuisine">Cuisine</a>
            <a href="#" id="editors" class="btn" role="button" data-bs-toggle="button" data-tags="editors">Editeurs</a>
            <a href="#" id="football" class="btn" role="button" data-bs-toggle="button" data-tags="football">Foot</a>
            <a href="#" id="kafka" class="btn" role="button" data-bs-toggle="button" data-tags="Kafka">Kafka</a>
            <a href="#" id="perec" class="btn" role="button" data-bs-toggle="button" data-tags="Perec">Perec</a>
            <a href="#" id="proust" class="btn" role="button" data-bs-toggle="button" data-tags="proust">Proust</a>
            <a href="#" id="poches" class="btn" role="button" data-bs-toggle="button" data-tags="poches">Folio</a>
            <a href="#" id="poesie" class="btn" role="button" data-bs-toggle="button" data-tags="poÃ©sie rimbaud">PoÃ©sie</a>
            <a href="#" id="polars" class="btn" role="button" data-bs-toggle="button" data-tags="polars pdjames">Polar</a>
            <a href="#" id="rimbaud" class="btn" role="button" data-bs-toggle="button" data-tags="rimbaud">Rimbaud</a>
            <a href="#" id="smallbooks" class="btn" role="button" data-bs-toggle="button" data-tags="smallbooks">Small Books</a>
            <a href="#" id="tintin" class="btn" role="button" data-bs-toggle="button" data-tags="tintin">Tintin</a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@latest/dist/js-yaml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/js/bootstrap.min.js"></script>
    <script>
        const container = document.getElementById("container");
        let entries

        class Counter {
            total = 0;
            sgl = 0;
            slds = 0;
            en = 0;
            it = 0;
            fr = 0;
            de = 0;
            pt = 0;
            sp = 0;
            count = (entry) => {
                switch (entry.lan) {
                    case 'ðŸ‡¬ðŸ‡§':
                        this.en++
                        break;
                    case 'ðŸ‡®ðŸ‡¹':
                        this.it++
                        break;
                    case 'ðŸ‡«ðŸ‡·':
                        this.fr++
                        break;
                    case 'ðŸ‡©ðŸ‡ª':
                        this.de++
                        break;
                    case 'ðŸ‡µðŸ‡¹':
                        this.pt++
                        break;
                    case 'ðŸ‡ªðŸ‡¸':
                        this.sp++
                        break;
                    default:
                        console.error("missing lan property", entry);
                }
                if (entry.where.includes("lipion")) {
                    this.sgl++
                } else {
                    this.slds++
                }
                this.total++
            };

            display = () => {
                document.getElementById("howmuch").innerHTML = `${this.total}`
                {
                    document.getElementById("c-ðŸ‡«ðŸ‡·").innerHTML = `${this.fr}`
                    document.getElementById("c-ðŸ‡®ðŸ‡¹").innerHTML = `${this.it}`
                    document.getElementById("c-ðŸ‡¬ðŸ‡§").innerHTML = `${this.en}`
                    document.getElementById("c-ðŸ‡©ðŸ‡ª").innerHTML = `${this.de}`
                    document.getElementById("c-ðŸ‡µðŸ‡¹").innerHTML = `${this.pt}`
                }
                {
                    document.getElementById("c-saint-jean-lipion").innerHTML = `${this.sgl}`
                    document.getElementById("c-saint-lazare-de-savene").innerHTML = `${this.slds}`
                }
            }

        }

        function selectOrUnselectTag(e) {

            const id = e.currentTarget.id
            const className = e.currentTarget.className
            const tags = e.currentTarget.dataset.tags.split(' ')

            const allBtns = document.getElementsByClassName("btn")
            for (const btn of allBtns) {
                if (btn.id === id) {
                    continue
                }
                btn.classList.remove("active")
            }

            const figures = document.querySelectorAll('figure')
            const c = new Counter()
            if (className.includes('active')) {
                for (const figure of figures) {
                    figure.style.display = "none"
                }
                for (const tag of tags) {
                    const taggeds = document.getElementsByClassName(tag)
                    for (const tagged of taggeds) {
                        c.count(entries[tagged.dataset.index][1])
                        tagged.style.display = "inline-block"
                    }
                }
            } else {
                for (const figure of figures) {
                    c.count(entries[figure.dataset.index][1])
                    figure.style.display = "inline-block"
                }
            }
            c.display()
        }

        const allBtns = document.getElementsByClassName("btn")
        for (const btn of allBtns) {
            btn.addEventListener("click", selectOrUnselectTag);
        }
        howmuch.addEventListener("click", () => {
            const allBtns = document.getElementsByClassName("btn")
            for (const btn of allBtns) {
                btn.classList.remove("active")
            }
            const figures = document.querySelectorAll('figure')
            const c = new Counter()
            for (const figure of figures) {
                c.count(entries[figure.dataset.index][1])
                figure.style.display = "inline-block"
            }
            c.display()
        })

        function blend(index, property) {
            const fig = document.createElement("figure");
            fig.dataset.index = index
            fig.classList.add("figure")
            fig.style = "padding: 10px; max-width: 158px;"
            for (const tagIndex in property.tags) {
                fig.classList.add(property.tags[tagIndex])
            }
            fig.classList.add(property.where)

            const img = document.createElement("img");
            img.src = property['image_path']
            img.classList.add("figure-img")
            img.classList.add("img-fluid")

            const figcaption = document.createElement("figcaption");
            figcaption.classList.add("figure-caption")
            figcaption.classList.add("text-wrap")
            figcaption.style = "width: 100%;" // border-bottom: 1px solid lightgray;

            let lan = property['lan'] || '';
            let author = property['de'].split(/ \(/)[0];
            let title = property['title']
            let where = property['where']
            const authorE = document.createTextNode(author);
            const titleE = document.createTextNode(title);
            const titleSPAN = document.createElement("span");
            titleSPAN.appendChild(titleE)
            titleSPAN.style = "font-size:smaller;"

            if (where.includes("lipion")) {
                const float1 = document.createElement("span");
                float1.classList.add("float-end")
                float1.style = "color: #b9e537; font-size: 14pt;"
                const flag = document.createTextNode('â§­'); // 
                float1.appendChild(flag)
                figcaption.appendChild(float1)
            }
            const flagE = document.createTextNode(lan);
            const float2 = document.createElement("span");
            float2.classList.add("float-end")
            float2.appendChild(flagE)
            float2.style = "font-size: larger;"
            // titleSPAN.appendChild(float2)
            figcaption.appendChild(authorE)
            figcaption.appendChild(document.createElement("br"))
            figcaption.appendChild(titleSPAN)
            fig.appendChild(img)
            fig.appendChild(figcaption)
            container.appendChild(fig)
        }

        function updateDisplay(text) {
            const doc = jsyaml.load(text, 'utf8')

            entries = Object.entries(doc);

            entries.sort((a, b) => {
                const nameA = a[1].de.toUpperCase().split(/ \(/)[0]
                const nameB = b[1].de.toUpperCase().split(/ \(/)[0]
                const splitA = nameA.split(/ /)
                const splitB = nameB.split(/ /)
                const lastnameA = splitA[splitA.length - 1]
                const lastnameB = splitB[splitB.length - 1]
                const lastnameDifference = lastnameA.localeCompare(lastnameB)
                if (lastnameDifference !== 0) {
                    return lastnameDifference
                }
                const nameDifference = nameA.localeCompare(nameB)
                if (nameDifference !== 0) {
                    return nameDifference
                }
                if (typeof a[1].title === "undefined" || typeof b[1].title === "undefined") {
                    console.log("boum!")
                }
                const titleA = a[1].title.toUpperCase()
                const titleB = b[1].title.toUpperCase()
                return titleA.localeCompare(titleB)
            })

            const c = new Counter();
            for (const property in entries) {
                const enableSkip = undefined // "tintin" // "Kafka" // "Perec" // 
                let skip = typeof enableSkip !== "undefined"
                if (typeof entries[property][1].tags !== "undefined") {
                    if (enableSkip) {
                        skip = !entries[property][1].tags.includes(enableSkip)
                    }
                    if (entries[property][1].tags.includes("verboten")) {
                        skip = true
                        console.log("SKIP", entries[property][1].de, entries[property][1].tags)
                    }
                }

                if (!skip) {
                    const entry = entries[property][1]
                    blend(property, entry)
                    c.count(entry)
                } else {
                    // console.log(entries[property][1])
                }

            }
            c.display()
        }

        function fetchData() {
            const xhr = new XMLHttpRequest()
            xhr.open("GET", "everything.yaml", true)
            xhr.onload = () => {
                updateDisplay(xhr.response)
            };
            xhr.send()
        }

        fetchData()

    </script>
</body>

</html>