<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bookshelves</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        figure:after {
            content: "";
            /* This is necessary for the pseudo element to work. */
            display: block;
            /* This will put the pseudo element on its own line. */
            margin: 0 auto;
            /* This will center the border. */
            width: 84%;
            /* Change this to whatever width you want. */
            padding-top: 20px;
            /* This creates some space between the element and the border. */
            border-bottom: 1px solid lightgray;
            /* This creates the border. Replace black with whatever color you want. */
        }

        .figure-img {
            margin-bottom: 0.25rem;
        }
    </style>
</head>

<body>
    <div id="container" class="container-fluid">
        <h1 id="howmuch" style="text-align: center;">…</h1>
        <h5 id="howmuch2" style="text-align: center;">…</h5>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@latest/dist/js-yaml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script>
        const container = document.getElementById("container");

        function blend(property) {
            const fig = document.createElement("figure");
            fig.classList.add("figure")
            fig.style = "padding: .4rem; max-width: 9.4rem;"

            const img = document.createElement("img");
            img.src = property['image_path']
            img.classList.add("figure-img")
            img.classList.add("img-fluid")

            const figcaption = document.createElement("figcaption");
            figcaption.classList.add("figure-caption")
            figcaption.classList.add("text-wrap")
            figcaption.style = "width: 100%;" // border-bottom: 1px solid lightgray;

            let lan = property['lan'] || '';
            let author = property['de'].split(/ \(/)[0];
            let title = property['title']
            let where = property['where']
            const authorE = document.createTextNode(author);
            const titleE = document.createTextNode(title);
            const titleSPAN = document.createElement("span");
            titleSPAN.appendChild(titleE)
            titleSPAN.style = "font-size:smaller;"

            if (where.includes("lipion")) {
                const float1 = document.createElement("span");
                float1.classList.add("float-end")
                float1.style = "color: #b9e537; font-size: 14pt;"
                const flag = document.createTextNode('⧭'); // 
                float1.appendChild(flag)
                figcaption.appendChild(float1)
            }
            const flagE = document.createTextNode(lan);
            const float2 = document.createElement("span");
            float2.classList.add("float-end")
            float2.appendChild(flagE)
            float2.style = "font-size: larger;"
            // titleSPAN.appendChild(float2)
            figcaption.appendChild(authorE)
            figcaption.appendChild(document.createElement("br"))
            figcaption.appendChild(titleSPAN)
            fig.appendChild(img)
            fig.appendChild(figcaption)
            container.appendChild(fig)
        }

        function updateDisplay(text) {
            const doc = jsyaml.load(text, 'utf8')

            const entries = Object.entries(doc);

            entries.sort((a, b) => {
                const nameA = a[1].de.toUpperCase().split(/ \(/)[0]
                const nameB = b[1].de.toUpperCase().split(/ \(/)[0]
                const splitA = nameA.split(/ /)
                const splitB = nameB.split(/ /)
                const lastnameA = splitA[splitA.length - 1]
                const lastnameB = splitB[splitB.length - 1]
                const lastnameDifference = lastnameA.localeCompare(lastnameB)
                if (lastnameDifference !== 0) {
                    return lastnameDifference
                }
                const nameDifference = nameA.localeCompare(nameB)
                if (nameDifference !== 0) {
                    return nameDifference
                }
                if (typeof a[1].title === "undefined" || typeof b[1].title === "undefined") {
                    console.log("boum!")
                }
                const titleA = a[1].title.toUpperCase()
                const titleB = b[1].title.toUpperCase()
                return titleA.localeCompare(titleB)
            })

            let count = 0
            let _sgl = 0
            let _slds = 0
            let _en = 0
            let _it = 0
            let _fr = 0
            let _de = 0
            let _pt = 0
            let _sp = 0
            for (const property in entries) {
                const enableSkip = undefined // "Kafka" // "Perec" // 
                let skip = typeof enableSkip !== "undefined"
                if (typeof entries[property][1].tags !== "undefined") {
                    if (enableSkip) {
                        skip = !entries[property][1].tags.includes(enableSkip)
                    }
                    if (entries[property][1].tags.includes("verboten")) {
                        skip = true
                        console.log("SKIP", entries[property][1].de, entries[property][1].tags)
                    }
                }

                if (!skip) {
                    const entry = entries[property][1]
                    blend(entry)
                    switch (entry.lan) {
                        case '🇬🇧':
                            _en++
                            break;
                        case '🇮🇹':
                            _it++
                            break;
                        case '🇫🇷':
                            _fr++
                            break;
                        case '🇩🇪':
                            _de++
                            break;
                        case '🇵🇹':
                            _pt++
                            break;
                        case '🇪🇸':
                            _sp++
                            break;
                        default:
                            console.error("missing lan property", entry);
                    }
                    if (entry.where.includes("lipion")) {
                        _sgl++
                    } else {
                        _slds++
                    }
                    count++
                } else {
                    // console.log(entries[property][1])
                }

            }
            document.getElementById("howmuch").innerHTML = `${count}`
            document.getElementById("howmuch2").innerHTML = `🇫🇷\u00A0${_fr}\u00A0\u00A0\u00A0🇮🇹\u00A0${_it}\u00A0\u00A0\u00A0🇬🇧\u00A0${_en}\u00A0\u00A0\u00A0🇩🇪\u00A0${_de}\u00A0\u00A0\u00A0🇵🇹\u00A0${_pt}\u00A0\u00A0\u00A0🇪🇸\u00A0${_sp}\u00A0\u00A0\u00A0⁞\u00A0\u00A0\u00A0↑\u00A0${_slds}\u00A0\u00A0\u00A0↓\u00A0${_sgl}`

        }

        function fetchData() {
            const xhr = new XMLHttpRequest()
            xhr.open("GET", "everything.yaml", true)
            xhr.onload = () => {
                updateDisplay(xhr.response)
            };
            xhr.send()
        }

        fetchData()

    </script>
</body>

</html>