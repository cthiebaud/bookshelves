<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <title>3D Scatter Plot from Image</title>
</head>
<body>

<div id="scatter-plot"></div>

<script>
    // Function to load the image and create 3D scatter plot
    function createScatterPlotFromImage(imagePath) {
        var img = new Image();

        img.onload = function() {
            var canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, img.width, img.height);

            var data = [];

            for (var y = 0; y < img.height; y++) {
                for (var x = 0; x < img.width; x++) {
                    var pixel = ctx.getImageData(x, y, 1, 1).data;
                    data.push({
                        x: pixel[0],  // Red component as x
                        y: pixel[1],  // Green component as y
                        z: pixel[2],  // Blue component as z
                        mode: 'markers',
                        type: 'scatter3d',
                        marker: {
                            size: 5,
                            color: `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`
                        }
                    });
                }
            }

            var layout = {
                scene: {
                    xaxis: { title: 'Red' },
                    yaxis: { title: 'Green' },
                    zaxis: { title: 'Blue' }
                }
            };

            Plotly.newPlot('scatter-plot', data, layout);
        };

        img.src = imagePath;
    }

    // Get the image path from the query string using URLSearchParams
    var queryParams = new URLSearchParams(window.location.search);
    var imagePathFromQueryString = queryParams.get('image');

    if (imagePathFromQueryString) {
        // Call the function with the image path from the query string
        createScatterPlotFromImage(imagePathFromQueryString);
    } else {
        console.error('Image path not provided in the query string.');
    }
</script>

</body>
</html>
